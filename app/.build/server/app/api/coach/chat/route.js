"use strict";(()=>{var e={};e.id=352,e.ids=[352],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},71379:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>d,dynamic:()=>p});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),l=r(75571),u=r(90455),c=r(9487);let p="force-dynamic";async function d(e){try{let t=await (0,l.getServerSession)(u.L);if(!t?.user)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{message:r,conversationHistory:s,userTier:a,isTrialUser:i}=await e.json();if(!r)return o.NextResponse.json({error:"Message is required"},{status:400});let n=await c._.user.findUnique({where:{id:t.user.id},include:{assessmentAnswers:!0,progressMetrics:!0,goalProgress:!0}});if(!n)return o.NextResponse.json({error:"User not found"},{status:404});let p=function(e){let t=new Date,r=e.trialEndDate?new Date(e.trialEndDate):null,s=e.trialStartDate?new Date(e.trialStartDate):null;if(!r||!s)return{isActive:!1,daysRemaining:0,hoursRemaining:0,hasExpired:!0,canUseFeature:"PRO"===e.subscriptionTier||"ENTERPRISE"===e.subscriptionTier,usageCount:e.trialUsageCount||0,dailyUsageCount:e.dailyUsageCount||0,maxDailyUsage:15};let a=t>r,i=r.getTime()-t.getTime(),n=e.isTrialActive&&!a&&"TRIAL"===e.subscriptionTier,o=n||"PRO"===e.subscriptionTier||"ENTERPRISE"===e.subscriptionTier;return{isActive:n,daysRemaining:Math.max(0,Math.ceil(i/864e5)),hoursRemaining:Math.max(0,Math.ceil(i/36e5)),hasExpired:a,canUseFeature:o,usageCount:e.trialUsageCount||0,dailyUsageCount:e.dailyUsageCount||0,maxDailyUsage:15}}(n);if(p.isActive){if(p.hasExpired)return o.NextResponse.json({error:"Trial expired. Please upgrade to continue."},{status:403});if(function(e){if(!e.dailyUsageResetDate)return!0;let t=new Date,r=new Date(e.dailyUsageResetDate);return Math.floor((t.getTime()-r.getTime())/864e5)>=1}(n)&&(await c._.user.update({where:{id:n.id},data:{dailyUsageCount:0,dailyUsageResetDate:new Date}}),n.dailyUsageCount=0),n.dailyUsageCount>=15)return o.NextResponse.json({error:"Daily usage limit reached. Upgrade to Pro for unlimited access."},{status:429});await c._.user.update({where:{id:n.id},data:{dailyUsageCount:n.dailyUsageCount+1,trialUsageCount:(n.trialUsageCount||0)+1}})}let d={experienceLevel:n?.experienceLevel||"BEGINNER",targetPlatforms:n?.targetPlatforms||[],businessType:n?.businessType||"PERSONAL_BRAND",primaryGoals:n?.primaryGoals||[],currentFollowers:n?.currentFollowers||{},recentProgress:n?.progressMetrics?.slice(-5)||[],activeGoals:n?.goalProgress?.filter(e=>"IN_PROGRESS"===e.status)||[]},g=s?.map(e=>({role:e.role,content:e.content}))||[],m=`You are an expert AI Social Media Coach with deep knowledge across all major platforms (YouTube, TikTok, Instagram, LinkedIn, Twitter, Facebook, Pinterest, Snapchat, etc.). Your role is to provide personalized, actionable advice to help users grow their social media presence and monetize their content.

USER CONTEXT:
- Experience Level: ${d.experienceLevel}
- Target Platforms: ${d.targetPlatforms.join(", ")||"Not specified"}
- Business Type: ${d.businessType}
- Primary Goals: ${d.primaryGoals.join(", ")||"Not specified"}
- Current Followers: ${JSON.stringify(d.currentFollowers)}

COACHING GUIDELINES:
1. Be encouraging, supportive, and motivational
2. Provide specific, actionable advice tailored to their platforms and goals
3. Reference current trends and best practices
4. Suggest concrete next steps they can implement immediately
5. Ask clarifying questions when needed to provide better guidance
6. Offer multiple strategies and let them choose what fits best
7. Include relevant metrics and growth targets when applicable

RESPONSE FORMAT:
- Keep responses conversational and engaging
- Use emojis sparingly but effectively
- Break down complex strategies into digestible steps
- Always end with a clear call-to-action or next step

Remember: You're not just providing information, you're coaching them toward success. Be their biggest supporter and strategic advisor.`,h=await fetch("https://apps.abacus.ai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.ABACUSAI_API_KEY}`},body:JSON.stringify({model:"gpt-4.1-mini",messages:[{role:"system",content:m},...g,{role:"user",content:r}],max_tokens:800,temperature:.7})});if(!h.ok)throw Error("Failed to get AI response");let y=await h.json(),w=y.choices[0]?.message?.content;if(!w)throw Error("No response from AI");let f=function(e,t){let r=e.toLowerCase(),s=[];return(r.includes("content")||r.includes("post"))&&(s.push("Content calendar for next week"),s.push("Trending topics in my niche"),s.push("Content repurposing strategies")),(r.includes("grow")||r.includes("follower"))&&(s.push("Platform-specific growth tactics"),s.push("Engagement optimization tips"),s.push("Hashtag strategy review")),(r.includes("money")||r.includes("monetiz"))&&(s.push("Revenue stream analysis"),s.push("Brand partnership opportunities"),s.push("Product creation ideas")),(r.includes("analytic")||r.includes("metric"))&&(s.push("Key metrics to track"),s.push("Performance improvement plan"),s.push("Competitor analysis")),0===s.length&&s.push("Weekly content strategy","Platform optimization tips","Audience engagement ideas","Growth goal setting"),s.slice(0,4)}(r,0);try{await c._.chatSession.create({data:{userId:t.user.id,title:r.substring(0,50)+"...",messages:{create:[{role:"USER",content:r},{role:"ASSISTANT",content:w}]}}})}catch(e){console.error("Failed to save conversation:",e)}return o.NextResponse.json({response:w,suggestions:f})}catch(e){return console.error("Coach chat error:",e),o.NextResponse.json({error:"Failed to process your message. Please try again."},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/coach/chat/route",pathname:"/api/coach/chat",filename:"route",bundlePath:"app/api/coach/chat/route"},resolvedPagePath:"/home/ubuntu/social_media_coach_app/app/app/api/coach/chat/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:y}=g,w="/api/coach/chat/route";function f(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},90455:(e,t,r)=>{r.d(t,{L:()=>l});var s=r(53797),a=r(13539),i=r(9487),n=r(42023),o=r.n(n);let l={adapter:(0,a.N)(i._),providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await i._.user.findUnique({where:{email:e.email}});return t&&t.password&&await o().compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name,image:t.image}:null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(t&&e.user&&(e.user.id=t.id),e)},pages:{signIn:"/auth/login"}}},9487:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(53524);let a=globalThis.prisma??new s.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,776,637,972],()=>r(71379));module.exports=s})();